    {% extends 'base.html' %}

    {% block scripts %}
    <script type="text/javascript"> 
        // output functions are configurable.  This one just appends some text
        // to a pre element.
        function outf(text) { 
            var mypre = document.getElementById("output"); 
            mypre.innerHTML = mypre.innerHTML + text; 
        } 
        function builtinRead(x) {
            if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
                    throw "File not found: '" + x + "'";
            return Sk.builtinFiles["files"][x];
        }
         
        // Here's everything you need to run a python program in skulpt
        // grab the code from your textarea
        // get a reference to your pre element for output
        // configure the output function
        // call Sk.importMainWithBody()
        function runit() { 
            var prog = myCodeMirror.getValue();
            if ($('#turtle-animation').is(":checked")) {
                
                var lines = prog.split('\n');
                // console.log(lines);
                for (var i = 0; i < lines.length; i++) {
                    if (lines[i].indexOf('turtle.Turtle()') != -1) {
                        var turtle_var = $.trim(lines[i].split('=')[0]);
                        lines.splice(i+1, 0, turtle_var + '.speed(0)');
                    }
                }
                prog = lines.join('\n');
            }

            var mypre = document.getElementById("output"); 
            mypre.innerHTML = ''; 
            Sk.canvas = "turtle-canvas";
            Sk.pre = "output";
            Sk.configure({output:outf, read:builtinRead}); 
            eval(Sk.importMainWithBody("<stdin>",false,prog)); 
        } 

        // when submit button is pressed
        function showSubmissionModal() {
            var dataURL = document.getElementById('turtle-canvas').toDataURL();      
            document.getElementById('turtle-image').src = dataURL;
            
            $('#myModal').on('shown', function() {
                $('#title').focus();
            });
            $('#myModal').modal();              
        }

        var myCodeMirror;
        var myDataRef;

        $(document).ready(function() {

            myDataRef = new Firebase('https://turtlegram.firebaseio.com/posts/' + "{{post_id}}/code");


            myCodeMirror = CodeMirror.fromTextArea(document.getElementById("yourcode"), {
                mode: {name: "python",
                    version: 2,
                    singleLineStringErrors: false},
                lineNumbers: true,
                textWrapping: false,
                indentUnit: 2,
                indentWithTabs: true,
                tabSize: 2,
                theme: 'twilight',
                autofocus: true,
                readOnly: true
            });

            // add shortcuts for editor
            shortcut.add("Meta+Enter",function() {
                runit();
            },{'type':'keydown',
                'propagate':false,
                'target':document
            });
            shortcut.add("Ctrl+Enter",function() {
                runit();
            },{'type':'keydown',
                'propagate':false,
                'target':document
            });

            myDataRef.once('value', function(data) {
                myCodeMirror.setValue(data.val());
                runit();
            });
        })
    </script> 

    {% endblock %}

    {% block content %}
        <div class="row">
            <div class="span12">
                <h1>TurtleGram Creator</h1>
                <p>Turtle graphics is a popular way for introducing programming to kids. It was part of the original Logo programming language developed by Wally Feurzig and Seymour Papert in 1966.Check out the documentation at the official Python docs <a href="http://docs.python.org/2/library/turtle.html" target="_blank">here</a>.</p>
                <p>Create your own <strong>awesome</strong> TurtleGram here and share them with the world!</p>
                <hr/>
            </div>
        </div>
        <div class="row">
            <div class="span5">         
                <h3>Canvas</h3>
                <canvas id="turtle-canvas" width="380" height="380"></mycanvas> 
            </div>
            <div class="span7">
                <h3>Info</h3>
            </div>
        </div>

        <div class="row">
            <div class="span12">
                <h3>Code</h3>
                <textarea id="yourcode" cols="40" rows="15"></textarea><br />
                <p style="display:inline-block; width: 100%">
                    <label class="checkbox">
                        <input type="checkbox" id="turtle-animation"/> 
                        Draw without animation
                    </label>
                    <br/>
                </p>
            </div>
        </div>

        <div class="row">
            <div class="span12">
                <button class="button run-button" onclick="runit()">Run Code</button> 
            </div>
        </div>
        <hr/>
        <div class="row">
            <div class="span12">
                <h3>Console</h3>
                <pre id="output" ></pre>  
            </div>
        </div>
        <div id="myModal" class="modal hide fade">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>TurtleGram Submission</h3>
            </div>
            <div class="modal-body">
                <center><img id="turtle-image" width="100" height="100" /></center>
                <hr/>
                <form class="form-horizontal">
                    <div class="control-group">
                        <label class="control-label">Title</label>
                        <div class="controls">
                            <input id="title" type="text" class="input-xlarge">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Creator</label>
                        <div class="controls">
                            <input id="creator" type="text" class="input-xlarge">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Description</label>
                        <div class="controls">
                            <textarea id="description" rows="3" class="input-xlarge"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="button submit-button" onclick="submitToBackend()">Submit</button>
                <button class="button clear-button" data-dismiss="modal" aria-hidden="true">Cancel</button>
            </div>
        </div>

    {% endblock %}